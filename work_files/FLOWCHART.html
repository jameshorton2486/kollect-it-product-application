<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kollect-It Product Application - System Flowchart</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eaeaea;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #e94560;
            margin-bottom: 10px;
            font-size: 2rem;
        }
        .subtitle {
            text-align: center;
            color: #a0a0a0;
            margin-bottom: 30px;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        .mermaid {
            background: #16213e;
            border-radius: 12px;
            padding: 20px;
            overflow-x: auto;
        }
        .section-title {
            color: #e94560;
            font-size: 1.3rem;
            margin: 30px 0 15px;
            border-bottom: 2px solid #e94560;
            padding-bottom: 5px;
        }
        .flowchart-container {
            margin-bottom: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèõÔ∏è Kollect-It Product Application</h1>
        <p class="subtitle">Complete System Architecture & Workflow</p>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #e94560;"></div>
                <span>Entry Points</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #16213e; border: 1px solid #e94560;"></div>
                <span>Process Steps</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #0f3460;"></div>
                <span>Decisions</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #48bb78;"></div>
                <span>Success</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fc8181;"></div>
                <span>Error</span>
            </div>
        </div>

        <!-- Main Overview Flowchart -->
        <div class="flowchart-container">
            <h2 class="section-title">üìä High-Level System Overview</h2>
            <div class="mermaid">
flowchart LR
    subgraph INPUT["üì• INPUT"]
        A[("üñ•Ô∏è Desktop App")]
        B[("‚öôÔ∏è Background Worker")]
    end
    
    subgraph PROCESS["‚ö° PROCESSING"]
        C[Image Pipeline]
        D[AI Generation]
        E[CDN Upload]
    end
    
    subgraph OUTPUT["üì§ OUTPUT"]
        F[("üåê Website")]
        G[("üìÅ Archive")]
    end
    
    A --> C
    B --> C
    C --> D
    D --> E
    E --> F
    F --> G
            </div>
        </div>

        <!-- Desktop App Detailed Flow -->
        <div class="flowchart-container">
            <h2 class="section-title">üñ•Ô∏è Desktop Application Flow</h2>
            <div class="mermaid">
flowchart TB
    START([Start App]) --> LOAD[Load config.json]
    LOAD --> GUI[Initialize Dark Theme GUI]
    GUI --> WAIT{Waiting for Input}
    
    WAIT -->|Drag & Drop| DROP[Receive Product Folder]
    WAIT -->|Browse| DIALOG[Open File Dialog]
    DIALOG --> DROP
    
    DROP --> SCAN[Scan for Image Files]
    SCAN --> THUMB[Generate Thumbnails]
    THUMB --> DISPLAY[Display in Grid]
    
    DISPLAY --> DETECT[Auto-Detect Category]
    DETECT --> SKU[Generate SKU<br/>e.g. MILI-2025-0001]
    
    SKU --> EDIT_IMG{Edit Images?}
    EDIT_IMG -->|Crop| CROP[Open Crop Tool]
    EDIT_IMG -->|Remove BG| BGREM[AI Background Removal]
    EDIT_IMG -->|Skip| OPTIMIZE
    CROP --> OPTIMIZE
    BGREM --> OPTIMIZE
    
    OPTIMIZE[Optimize: Resize ‚Üí WebP ‚Üí Strip EXIF]
    OPTIMIZE --> UPLOAD[Upload to ImageKit CDN]
    
    UPLOAD --> AI[Generate AI Description]
    AI --> SEO[Generate SEO Content]
    SEO --> PRICE[AI Valuation Estimate]
    
    PRICE --> REVIEW[User Review & Edit]
    REVIEW --> PUBLISH{Publish?}
    PUBLISH -->|Yes| SEND[POST to API]
    PUBLISH -->|Edit| REVIEW
    
    SEND --> SUCCESS([Product Live!])
            </div>
        </div>

        <!-- Image Processing Pipeline -->
        <div class="flowchart-container">
            <h2 class="section-title">üì∏ Image Processing Pipeline</h2>
            <div class="mermaid">
flowchart LR
    subgraph INPUT["Raw Input"]
        RAW[JPG/PNG/TIFF/BMP]
    end
    
    subgraph OPTIONAL["Optional Edits"]
        CROP[‚úÇÔ∏è Crop Tool]
        BGREM[üé® Background Removal]
    end
    
    subgraph OPTIMIZE["Optimization"]
        RESIZE[üìê Resize<br/>Max 2400px]
        CONVERT[üîÑ Convert<br/>to WebP]
        STRIP[üßπ Strip EXIF]
        ORIENT[‚Üª Auto-Orient]
    end
    
    subgraph OUTPUT["Output"]
        WEBP[Optimized WebP<br/>Quality: 88%]
        THUMB[Thumbnail<br/>400px]
    end
    
    RAW --> CROP
    RAW --> BGREM
    CROP --> RESIZE
    BGREM --> RESIZE
    RAW --> RESIZE
    RESIZE --> CONVERT
    CONVERT --> STRIP
    STRIP --> ORIENT
    ORIENT --> WEBP
    ORIENT --> THUMB
            </div>
        </div>

        <!-- AI Generation Flow -->
        <div class="flowchart-container">
            <h2 class="section-title">ü§ñ AI Content Generation</h2>
            <div class="mermaid">
flowchart TB
    START[Product Images + Context] --> API[Claude API<br/>claude-sonnet-4]
    
    API --> TEMPLATE{Select Template}
    TEMPLATE -->|militaria| T1[militaria_template.json]
    TEMPLATE -->|collectibles| T2[collectibles_template.json]
    TEMPLATE -->|books| T3[books_template.json]
    TEMPLATE -->|fineart| T4[fineart_template.json]
    
    T1 --> GEN
    T2 --> GEN
    T3 --> GEN
    T4 --> GEN
    
    GEN[Generate Content]
    
    GEN --> DESC[üìù Description<br/>200-400 words]
    GEN --> TITLE[üè∑Ô∏è Suggested Title]
    GEN --> SEO[üîç SEO Title & Meta]
    GEN --> KEYWORDS[üîë Keywords 8-12]
    GEN --> VALUATION[üí∞ Price Estimate<br/>Low / High / Recommended]
    GEN --> NOTES[üìã Collector Notes]
    
    DESC --> JSON[Return JSON Response]
    TITLE --> JSON
    SEO --> JSON
    KEYWORDS --> JSON
    VALUATION --> JSON
    NOTES --> JSON
            </div>
        </div>

        <!-- Publishing Flow -->
        <div class="flowchart-container">
            <h2 class="section-title">üåê Publishing to Website</h2>
            <div class="mermaid">
flowchart TB
    subgraph CLIENT["Desktop App / Worker"]
        PREPARE[Prepare Product Data]
        PREPARE --> VALIDATE[Validate Required Fields]
        VALIDATE --> SEND[POST Request<br/>x-api-key: SERVICE_API_KEY]
    end
    
    subgraph SERVER["Next.js Backend"]
        RECEIVE[Receive Request]
        RECEIVE --> AUTH{Validate<br/>API Key}
        AUTH -->|Invalid| R401[401 Unauthorized]
        AUTH -->|Valid| PARSE[Parse JSON Body]
        
        PARSE --> CHECK_SKU{SKU<br/>Exists?}
        CHECK_SKU -->|Yes| R409[409 Conflict]
        CHECK_SKU -->|No| SLUG[Generate URL Slug]
        
        SLUG --> DB[Create in Prisma DB]
        DB --> IMAGES[Create Image Records]
        IMAGES --> R201[201 Created<br/>Return Product URL]
    end
    
    subgraph RESPONSE["Response Handling"]
        R201 --> SUCCESS[‚úÖ Show Success<br/>Link to Product]
        R401 --> ERROR1[‚ùå Check API Key]
        R409 --> ERROR2[‚ùå SKU Already Used]
    end
    
    SEND --> RECEIVE
            </div>
        </div>

        <!-- Background Worker Flow -->
        <div class="flowchart-container">
            <h2 class="section-title">‚öôÔ∏è Background Automation Worker</h2>
            <div class="mermaid">
flowchart TB
    START([Worker Starts]) --> CONFIG[Load Configuration]
    CONFIG --> LOOP[Main Loop]
    
    LOOP --> SCAN[Scan Watch Folder<br/>Every 60 seconds]
    SCAN --> CHECK{New Folders?}
    
    CHECK -->|No| WAIT[Wait 60s]
    WAIT --> SCAN
    
    CHECK -->|Yes| QUEUE[Add to Queue]
    QUEUE --> PROCESS[Process Folder]
    
    PROCESS --> IMG[Image Pipeline]
    IMG --> CDN[Upload to ImageKit]
    CDN --> AI[AI Generation]
    AI --> PUBLISH[Auto-Publish to Website]
    
    PUBLISH --> RESULT{Success?}
    RESULT -->|Yes| ARCHIVE[Move to /Completed]
    RESULT -->|No| FAILED[Move to /Failed<br/>Log Error]
    
    ARCHIVE --> LOG[Log Success]
    FAILED --> LOG
    LOG --> SCAN
            </div>
        </div>

        <!-- SKU Generation -->
        <div class="flowchart-container">
            <h2 class="section-title">üî¢ SKU Generation System</h2>
            <div class="mermaid">
flowchart LR
    CAT[Category Selected] --> PREFIX{Get Prefix}
    PREFIX -->|Militaria| MILI[MILI]
    PREFIX -->|Collectibles| COLL[COLL]
    PREFIX -->|Books| BOOK[BOOK]
    PREFIX -->|Fine Art| ART[ART]
    
    MILI --> YEAR
    COLL --> YEAR
    BOOK --> YEAR
    ART --> YEAR
    
    YEAR[Current Year<br/>2025]
    YEAR --> COUNTER[Load Counter<br/>from sku_state.json]
    COUNTER --> INCREMENT[Increment +1]
    INCREMENT --> FORMAT[Format: 0001]
    FORMAT --> SKU[PREFIX-YYYY-NNNN<br/>e.g. MILI-2025-0042]
    SKU --> SAVE[Save to sku_state.json]
            </div>
        </div>

    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#e94560',
                primaryTextColor: '#fff',
                primaryBorderColor: '#e94560',
                lineColor: '#a0a0a0',
                secondaryColor: '#16213e',
                tertiaryColor: '#0f3460',
                background: '#1a1a2e',
                mainBkg: '#16213e',
                nodeBorder: '#e94560',
                clusterBkg: '#16213e',
                clusterBorder: '#e94560',
                titleColor: '#e94560',
                edgeLabelBackground: '#16213e'
            },
            flowchart: {
                curve: 'basis',
                padding: 20
            }
        });
    </script>
</body>
</html>
